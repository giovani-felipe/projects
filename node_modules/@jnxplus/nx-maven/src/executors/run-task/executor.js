"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = runExecutor;
const tslib_1 = require("tslib");
const common_1 = require("@jnxplus/common");
const devkit_1 = require("@nx/devkit");
const path = require("path");
const utils_1 = require("../../utils");
function runExecutor(options, context) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const targetName = (0, common_1.getTargetName)(context);
        if (options.skipExecutor) {
            devkit_1.logger.warn(`Skipping executor ran for ${targetName}`);
            return { success: true };
        }
        devkit_1.logger.info(`Executor ran for ${targetName}: ${JSON.stringify(options)}`);
        let task = '';
        if (Array.isArray(options.task)) {
            task = options.task.join(' ');
        }
        else {
            task = options.task;
        }
        let command = `${(0, utils_1.getExecutable)()} ${task}`;
        if (!options.skipProject) {
            command += ` -pl :${context.projectName}`;
        }
        let cwd;
        if (options.cwd && path.isAbsolute(options.cwd)) {
            cwd = options.cwd;
        }
        else {
            const mavenRootDirectory = (0, utils_1.getMavenRootDirectory)();
            if (options.cwd) {
                cwd = path.join(devkit_1.workspaceRoot, mavenRootDirectory, options.cwd);
            }
            else {
                cwd = path.join(devkit_1.workspaceRoot, mavenRootDirectory);
            }
        }
        return (0, common_1.runCommand)(command, cwd);
    });
}
//# sourceMappingURL=executor.js.map